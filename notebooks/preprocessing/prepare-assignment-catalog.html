<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lyndon Estes">

<title>Prepare Intermediate Assignment Catalog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="prepare-assignment-catalog_files/libs/clipboard/clipboard.min.js"></script>
<script src="prepare-assignment-catalog_files/libs/quarto-html/quarto.js"></script>
<script src="prepare-assignment-catalog_files/libs/quarto-html/popper.min.js"></script>
<script src="prepare-assignment-catalog_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="prepare-assignment-catalog_files/libs/quarto-html/anchor.min.js"></script>
<link href="prepare-assignment-catalog_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="prepare-assignment-catalog_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="prepare-assignment-catalog_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="prepare-assignment-catalog_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="prepare-assignment-catalog_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a></li>
  <li><a href="#label-ranking-system" id="toc-label-ranking-system" class="nav-link" data-scroll-target="#label-ranking-system"><span class="header-section-number">2</span> Label ranking system</a>
  <ul>
  <li><a href="#general-quality-measures" id="toc-general-quality-measures" class="nav-link" data-scroll-target="#general-quality-measures"><span class="header-section-number">2.1</span> General quality measures</a></li>
  </ul></li>
  <li><a href="#assignment-catalog" id="toc-assignment-catalog" class="nav-link" data-scroll-target="#assignment-catalog"><span class="header-section-number">3</span> Assignment catalog</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Prepare Intermediate Assignment Catalog</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lyndon Estes </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="overview" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1</span> Overview</h2>
<p>The assembled quality metrics were used to develop a set of quality ranking associated with each label, and combined with the processed assignment catalog (from the <a href="analyze-assignments.html">analyze assignments notebook</a>) to make an interim assignment catalog with general information on label quality. The final assignment catalog was developed in <a href="prepare_fields.qmd">prepare_fields.qmd</a>, where Class 1 labels and quality metrics were added. The interim catalog here provides the inputs for chipping the Planet imagery to their final outputs, as all images were represented in these assignments (excluding those flagged as low quality).</p>
</section>
<section id="label-ranking-system" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="label-ranking-system"><span class="header-section-number">2</span> Label ranking system</h2>
<section id="general-quality-measures" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="general-quality-measures"><span class="header-section-number">2.1</span> General quality measures</h3>
<p>Using the various quality metrics, several measures of labeller quality can be calculated, which are then assigned to all sites mapped by a given labeller.</p>
<p>The first set of measures were derived from the Q assignment scores, using the individual measures for overall Score, N, Edge, and Area, and calculating the average of these for each labeller. The second set are from the expert review rankings, which are provided for all 5 ranking categories, and for the simplified binary categorization. A comparison of the average score for each labeller from both variants shows that the simplified binary metric has a strong, nearly perfect linear relationship <a href="#fig-rscores">Figure&nbsp;1</a> with the more detailed 5 category measure (note: category 4 was recoded to 3 in calculating the per labeller averages, to avoid giving more weight for correctly identified negative sites). This simpler measure was therefore selected to use in preference to the more complicated measure, given that it had a greater level of between-expert agreement (see analysis of expert labels).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-rscores" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="prepare-assignment-catalog_files/figure-html/fig-rscores-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: The relationship between the average expert review score for each labeller, as calculated from the average of all 5 ranking categories (x axis), and from the simplified binary score (y-axis).</figcaption>
</figure>
</div>
</div>
</div>
<p>A Spearman-rank correlation analysis of the mean Q score metrics and the binary expert review scores (Rscore) reveals that the expert scores are most correlated (based on non-parametric Kendall rank correlation coefficient) with the overall Q score, followed by area mapped (Area) and number of fields (N), and were least correlated with edge accuracy <a href="#fig-scorecor">Figure&nbsp;2</a>. The relative strength of these associations reflects the nature of expert reviews, which were quick assessments of whether labellers captured the overall area of fields in the image correctly, and whether they over- or under-segmented (an assessment most closely related to the N measure). Within the Q score measures, the Area and Edge were most strongly associated with one another while N and Area were least associated.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-scorecor" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="prepare-assignment-catalog_files/figure-html/fig-scorecor-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Scatter plots of the relationships between the per labeller averages of the various score components, comparing the expert-based Rscore against the 4 Q score based measures, and Area against Edge and N. Regressions were fit using the Theil-Sen estimator with correlations based on the Kendall Rank correlation coefficient. Numbers in the plot are labeller IDs.</figcaption>
</figure>
</div>
</div>
</div>
<p>Given these results, 3 of the metrics were retained to provide general measures of label quality: Score, N, and Rscore. Edge was not included, given its generally low overall value, while Area was dropped because it is the largest contributor to Score. The labeller mean Score and N were respectively renamed to Qscore and QN, while the values of Score and N, along with Edge, Area, and rscore and rscore2 were retained in the dataset for their specific assignments. These specific scores are recommended for selecting high quality sites for model fine-tuning and/or final model validation.</p>
</section>
</section>
<section id="assignment-catalog" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="assignment-catalog"><span class="header-section-number">3</span> Assignment catalog</h2>
<p>The interim assignment catalog contains the aforementioned specific and general quality measures, along the site name, assignment ID, the assignment type, labeller ID, the time in minutes spent completing the assignment, the date and time the assignment was completed, the number of fields digitized for the assignment, and the average area of digitized fields.</p>
<p>Join with the tile data as reference for chipping.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>